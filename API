import requests


registration_url = "https://bfhldevapigw.healthrx.co.in/hiring/generateWebhook/PYTHON"

payload = {
    "name": "Janhvee Laad",          
    "regNo": "0827CY221026",          
    "email": "janhveelaad221191@acropolis.in"      
}
response = requests.post(registration_url, json=payload)
if response.status_code != 200:
    print("Failed to register:", response.text)
    exit()
data = response.json()
webhook_url = data['webhook']
access_token = data['accessToken']
print("Webhook URL:", webhook_url)
print("Access Token:", access_token)
sql_query = """
SELECT 
    CONCAT(e.first_name, ' ', e.last_name) AS name,
    TIMESTAMPDIFF(YEAR, e.DoB, CURDATE()) AS age,
    d.department_name,
    p.amount AS salary
FROM payments p
JOIN employee e ON p.emp_id = e.emp_id
JOIN department d ON e.department_id = d.department_id
WHERE DAY(p.payment_time) != 1
ORDER BY p.amount DESC
LIMIT 1;
"""
headers = {
    "Authorization": access_token,
    "Content-Type": "application/json"
}
solution_payload = {
    "finalQuery": sql_query
}
submit_response = requests.post(webhook_url, headers=headers, json=solution_payload)

print("Submission Response Status Code:", submit_response.status_code)
print("Response Text:", submit_response.text)
